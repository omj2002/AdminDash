<div class="analytics-container">
  <div class="analytics-header">
    <h1>Analytics & Reports</h1>
    <div class="header-controls">
      <mat-form-field appearance="outline" class="period-selector">
        <mat-label>Time Period</mat-label>
        <mat-select [(ngModel)]="selectedPeriod" (selectionChange)="onPeriodChange()">
          <mat-option *ngFor="let period of periods" [value]="period.value">
            {{ period.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="exportData()">
        <mat-icon>download</mat-icon>
        Export JSON
      </button>
      <button mat-raised-button color="accent" (click)="exportCSV()">
        <mat-icon>table_chart</mat-icon>
        Export CSV
      </button>
    </div>
  </div>

  <!-- Key Metrics Cards -->
  <div class="metrics-grid">
    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-content">
          <div class="metric-info">
            <h3>${{ analyticsData[selectedPeriod]?.revenue | number }}</h3>
            <p>Total Revenue</p>
            <span class="change positive">+{{ (analyticsData[selectedPeriod]?.conversion || 0) * 10 }}%</span>
          </div>
          <div class="metric-icon">
            <mat-icon>attach_money</mat-icon>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-content">
          <div class="metric-info">
            <h3>{{ analyticsData[selectedPeriod]?.orders | number }}</h3>
            <p>Total Orders</p>
            <span class="change positive">+{{ (analyticsData[selectedPeriod]?.conversion || 0) * 8 }}%</span>
          </div>
          <div class="metric-icon">
            <mat-icon>shopping_cart</mat-icon>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-content">
          <div class="metric-info">
            <h3>{{ analyticsData[selectedPeriod]?.users | number }}</h3>
            <p>Total Users</p>
            <span class="change positive">+{{ (analyticsData[selectedPeriod]?.conversion || 0) * 5 }}%</span>
          </div>
          <div class="metric-icon">
            <mat-icon>people</mat-icon>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-content">
          <div class="metric-info">
            <h3>{{ analyticsData[selectedPeriod]?.conversion }}%</h3>
            <p>Conversion Rate</p>
            <span class="change positive">+{{ (analyticsData[selectedPeriod]?.conversion || 0) * 0.5 }}%</span>
          </div>
          <div class="metric-icon">
            <mat-icon>trending_up</mat-icon>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <mat-tab-group [(selectedIndex)]="selectedTab">
      <mat-tab label="Sales Analytics">
        <div class="tab-content">
          <div class="chart-row">
            <mat-card class="chart-card large">
              <mat-card-header>
                <mat-card-title>Revenue & Profit Trends</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas baseChart
                  [data]="salesChartData"
                  [options]="salesChartOptions"
                  type="line">
                </canvas>
              </mat-card-content>
            </mat-card>
          </div>

          <div class="chart-row">
            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>User Growth</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas baseChart
                  [data]="userGrowthChartData"
                  [options]="userGrowthChartOptions"
                  type="bar">
                </canvas>
              </mat-card-content>
            </mat-card>

            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>Category Distribution</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas baseChart
                  [data]="topProductsChartData"
                  type="doughnut">
                </canvas>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Conversion Funnel">
        <div class="tab-content">
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>Conversion Funnel Analysis</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <canvas baseChart
                [data]="conversionFunnelData"
                type="bar">
              </canvas>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab label="Top Products">
        <div class="tab-content">
          <mat-card class="table-card">
            <mat-card-header>
              <mat-card-title>Top Performing Products</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="table-container">
                <table mat-table [dataSource]="topProducts" class="products-table">
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>Product Name</th>
                    <td mat-cell *matCellDef="let product">{{ product.name }}</td>
                  </ng-container>

                  <ng-container matColumnDef="sales">
                    <th mat-header-cell *matHeaderCellDef>Sales</th>
                    <td mat-cell *matCellDef="let product">{{ product.sales | number }}</td>
                  </ng-container>

                  <ng-container matColumnDef="revenue">
                    <th mat-header-cell *matHeaderCellDef>Revenue</th>
                    <td mat-cell *matCellDef="let product">{{ product.revenue | currency:'USD':'symbol':'1.0-0' }}</td>
                  </ng-container>

                  <ng-container matColumnDef="growth">
                    <th mat-header-cell *matHeaderCellDef>Growth</th>
                    <td mat-cell *matCellDef="let product">
                      <span class="growth positive">{{ product.growth }}</span>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="['name', 'sales', 'revenue', 'growth']"></tr>
                  <tr mat-row *matRowDef="let row; columns: ['name', 'sales', 'revenue', 'growth'];"></tr>
                </table>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <!-- Recent Activity -->
  <div class="activity-section">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Recent Activity</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="activity-list">
          <div class="activity-item" *ngFor="let activity of recentActivity">
            <mat-icon [ngClass]="'activity-' + getActivityColor(activity.type)">
              {{ getActivityIcon(activity.type) }}
            </mat-icon>
            <div class="activity-content">
              <h4>{{ activity.action }}</h4>
              <p>{{ activity.description }}</p>
              <span class="time">{{ activity.time }}</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
